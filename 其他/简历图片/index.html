<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人项目图片展示</title>

</head>
<body>

<div class="container">
    <h1 style="text-align: center">个人项目图片展示</h1>
    <div id="home"></div>
</div>
</body>
<script>
    // folder: 图片所在文件夹名，与 img 拼接为完整路径 url + folder + "/" + img
    // 列表从 fileList.json 加载，v1.js 可扫描 img/ 只追加不存在的文件夹
    let htmlList = [];
    const url = "./img/";
    let htmlTable = "";

    function init() {
        htmlTable = "";
        for (const html of htmlList) {
            let htmlDataTable = "";
            for (const text of html.data) {
                const imgSrc = url + html.folder + "/" + text.img;
                htmlDataTable += `
                    <div class="image-scroll-item">
                        <div class="project-img-container">
                            <img src="${imgSrc}" loading="lazy" class="img-fluid" onclick="enlargeImage(this.src, '${html.text.replace(/'/g, "\\'")}')" alt="${(text.text || '').replace(/"/g, '&quot;')}">
                            <div class="img-title">${text.text}</div>
                        </div>
                    </div>
                `;
            }

            htmlTable += `
                <br>
                <br>
                <br>
                <h3 class="section-title">${html.text}</h3>
                <div class="image-scroll-container web-development">
                    ${htmlDataTable}
                </div>
            `;
        }

        document.getElementById("home").innerHTML = htmlTable;
    }

    fetch('./fileList.json')
        .then(res => res.json())
        .then(data => {
            htmlList = data;
            init();
        })
        .catch(err => {
            document.getElementById("home").innerHTML = '<p style="color:red">加载 fileList.json 失败，请确保存在该文件。</p>';
            console.error(err);
        });

    let currentImageIndex = 0;
    let currentImagesData = [];
    let currentSectionFolder = "";

    function enlargeImage(src, sectionText) {
        // 找到当前图片所在的数据组
        const section = htmlList.find(s => s.text === sectionText);
        const sectionData = section.data;
        currentSectionFolder = section.folder;
        currentImagesData = sectionData;
        const pathAfterUrl = src.replace(url, '');
        currentImageIndex = currentImagesData.findIndex(item => (currentSectionFolder + "/" + item.img) === pathAfterUrl);

        const enlargedImgContainer = document.createElement('div');
        enlargedImgContainer.classList.add('enlarged-img-container');

        const prevBtn = document.createElement('div');
        prevBtn.classList.add('slide-btn', 'prev-btn');
        prevBtn.innerHTML = '&#10094;';
        prevBtn.addEventListener('click', () => slideImage(-1));

        const nextBtn = document.createElement('div');
        nextBtn.classList.add('slide-btn', 'next-btn');
        nextBtn.innerHTML = '&#10095;';
        nextBtn.addEventListener('click', () => slideImage(1));

        const enlargedImg = document.createElement('img');
        enlargedImg.classList.add('enlarged-img');
        enlargedImg.src = src;

        const closeBtn = document.createElement('div');
        closeBtn.classList.add('close-btn');
        closeBtn.innerHTML = '&times;';
        closeBtn.addEventListener('click', () => {
            document.body.removeChild(enlargedImgContainer);
        });

        enlargedImgContainer.appendChild(prevBtn);
        enlargedImgContainer.appendChild(nextBtn);
        enlargedImgContainer.appendChild(enlargedImg);
        enlargedImgContainer.appendChild(closeBtn);
        document.body.appendChild(enlargedImgContainer);

        // 显示放大图片容器
        enlargedImgContainer.style.display = 'flex';

        // ESC 键关闭大图预览
        window.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                document.body.removeChild(enlargedImgContainer);
            }
        });

        // 点击外部关闭大图预览
        enlargedImgContainer.addEventListener('click', (event) => {
            if (event.target === enlargedImgContainer) {
                document.body.removeChild(enlargedImgContainer);
            }
        });

        // 触摸和鼠标拖动事件处理
        let startX, startY, moveX, moveY, isDragging = false;

        enlargedImg.addEventListener('mousedown', (e) => {
            startX = e.clientX;
            startY = e.clientY;
            isDragging = true;
        });

        enlargedImg.addEventListener('mousemove', (e) => {
            if (isDragging) {
                moveX = e.clientX;
                moveY = e.clientY;
            }
        });

        enlargedImg.addEventListener('mouseup', () => {
            if (isDragging) {
                const distanceX = moveX - startX;
                if (Math.abs(distanceX) > 50) {
                    slideImage(distanceX > 0 ? -1 : 1);
                }
                isDragging = false;
            }
        });

        enlargedImg.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
            isDragging = true;
        });

        enlargedImg.addEventListener('touchmove', (e) => {
            if (isDragging) {
                moveX = e.touches[0].clientX;
                moveY = e.touches[0].clientY;
            }
        });

        enlargedImg.addEventListener('touchend', () => {
            if (isDragging) {
                const distanceX = moveX - startX;
                if (Math.abs(distanceX) > 50) {
                    slideImage(distanceX > 0 ? -1 : 1);
                }
                isDragging = false;
            }
        });
    }

    function slideImage(direction) {
        const enlargedImgContainer = document.querySelector('.enlarged-img-container');
        if (!enlargedImgContainer) return;

        const enlargedImg = enlargedImgContainer.querySelector('.enlarged-img');
        if (!enlargedImg) return;

        currentImageIndex += direction;
        if (currentImageIndex < 0) {
            currentImageIndex = currentImagesData.length - 1;
        } else if (currentImageIndex >= currentImagesData.length) {
            currentImageIndex = 0;
        }

        const newSrc = url + currentSectionFolder + "/" + currentImagesData[currentImageIndex].img;
        enlargedImg.src = newSrc;
    }
</script>




<style>
    /* 全局样式 */
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        background-image: url('data:image/svg+xml,%3Csvg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="%23cccccc" fill-opacity="0.4" fill-rule="evenodd"%3E%3Ccircle cx="3" cy="3" r="3" /%3E%3Ccircle cx="13" cy="13" r="3" /%3E%3Ccircle cx="23" cy="23" r="3" /%3E%3Ccircle cx="33" cy="33" r="3" /%3E%3C/g%3E%3C/svg%3E');
    }

    /* 图片容器样式 */
    .project-img-container {
        position: relative;
        overflow: hidden;
        transition: transform 0.3s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        width: 100%;
    }

    /* 鼠标悬停时图片放大及标题显示效果 */
    .project-img-container:hover .img-fluid {
        transform: scale(1.1);
    }

    .project-img-container:hover .img-title {
        opacity: 1;
    }

    /* 章节标题样式 */
    .section-title {
        font-size: 24px;
        font-weight: bold;
        margin-top: 30px;
        color: #333;
    }

    /* 容器布局样式 */
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    /* 图片滚动容器样式 */
    .image-scroll-container {
        display: flex;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
        padding: 10px 0;
    }

    /* 单个图片项目样式（用于滚动容器内） */
    .image-scroll-item {
        flex: 0 0 auto;
        scroll-snap-align: start;
        margin-right: 10px;
    }

    /* 放大后的图片容器样式 */
    .enlarged-img-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }

    /* 放大后的图片样式 */
    .enlarged-img {
        max-width: 90%;
        max-height: 90%;
    }

    /* 关闭按钮样式 */
    .close-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        color: white;
        font-size: 24px;
        cursor: pointer;
    }

    /* 滑动按钮样式 */
    .slide-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        color: white;
        font-size: 36px;
        cursor: pointer;
        user-select: none;
    }

    .prev-btn {
        left: 20px;
    }

    .next-btn {
        right: 20px;
    }
</style>
<style>

    .img-fluid {
        height: 250px;
        width: auto;
        object-fit: cover;
        border-radius: 8px;
        transition: transform 0.3s ease;
        cursor: pointer;
    }


    @media only screen and (max-width: 600px) {
        .img-fluid {
            height: 100px;
        }
    }




    /* 图片标题样式 */
    .img-title {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 5px;
        text-align: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
</style>
</html>